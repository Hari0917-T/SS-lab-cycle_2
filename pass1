#include <stdio.h>
#include <string.h>
#include <stdlib.h>
int main() {
    FILE *fp1, *fp2, *fp3;
    char label[20], opcode[20], operand[20];
    int locctr, start, length;
    fp1 = fopen("input.txt", "r");
    fp2 = fopen("intermediate.txt", "w");
    fp3 = fopen("symtab.txt", "w");
    if (!fp1) {
        printf("Error: Cannot open input file.\n");
        return 1;
    }
    fscanf(fp1, "%s %s %s", label, opcode, operand);
    if (strcmp(opcode, "START") == 0) {
        start = atoi(operand);
        locctr = start;
        fprintf(fp2, "\t%s\t%s\t%s\n", label, opcode, operand);
        fscanf(fp1, "%s %s %s", label, opcode, operand);
    } else {
        locctr = 0;
    }
    while (strcmp(opcode, "END") != 0 && !feof(fp1)) {
        fprintf(fp2, "%d\t%s\t%s\t%s\n", locctr, label, opcode, operand);

        if (strcmp(label, "") != 0 && strcmp(label, "-") != 0) {
            fprintf(fp3, "%s\t%d\n", label, locctr);
        }
        if (strcmp(opcode, "WORD") == 0)
            locctr += 3;
        else if (strcmp(opcode, "RESW") == 0)
            locctr += 3 * atoi(operand);
        else if (strcmp(opcode, "RESB") == 0)
            locctr += atoi(operand);
        else if (strcmp(opcode, "BYTE") == 0)
            locctr += 1; 
        else
            locctr += 3; 
        if (fscanf(fp1, "%s %s %s", label, opcode, operand) != 3)
            break; 
    }
    fprintf(fp2, "%d\t%s\t%s\t%s\n", locctr, label, opcode, operand);
    length = locctr - start;
    printf("\nPASS 1 completed successfully âœ…");
    printf("\nProgram length = %d\n", length);
    fclose(fp1);
    fclose(fp2);
    fclose(fp3);
    return 0;
}
